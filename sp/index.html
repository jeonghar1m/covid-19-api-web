<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>코로나19 감염자 현황</title>
    <link rel="stylesheet" type="text/css" href="style.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.3/jquery.min.js"></script>
</head>
<body>
    <header>
        <div id="lang_button">
            <script>
                const langs = ['한국어', 'English'];
                langs.forEach((lang)=> {
                    $("#lang_button").append(
                        '<input type="button" value="' + lang + '" />'
                    );
                })
            </script>
        </div>
        <div id="title_name"><h1>코로나19 현황 조회하기</h1></div>
    </header>
    <section>
        <fieldset>
            <table>
                <legend>도시 선택</legend>
                <tr>
                    <td id="cities">
                        <script>
                            var lang = '한국어';    // 기본값 한국어
                            PrintButton();

                            $('#lang_button input[type=button]').on('click', function(value) {
                                if($(this).val() == "한국어") {
                                    $('title').empty();
                                    $('legend').empty();
                                    $('#title_name').empty();

                                    $('title').prepend('코로나19 감염자 현황');
                                    $('legend').prepend('도시 선택');
                                    $('#title_name').prepend('<h1>코로나19 현황 조회하기</h1>');

                                    lang = "한국어";
                                }
                                else if($(this).val() == "English") {
                                    $('title').empty();
                                    $('legend').empty();
                                    $('#title_name').empty();

                                    $('title').prepend('Covid19 Infected Status');
                                    $('legend').prepend('Select the city');
                                    $('#title_name').prepend('<h1>Covid19 Status</h1>');
                                    
                                    lang = "English";
                                }

                                PrintButton();
                                    
                                console.log("Button Language: " + lang);
                            })

                            function PrintButton() {
                                $("#cities").empty();

                                if(lang == '한국어') {
                                    cities = ["전국", "서울", "제주", "경남", "경북", "전남", "전북", "충남", "충북", "강원", "경기", "세종", "울산",
                                    "대전", "광주", "인천", "대구", "부산"];
                                }
                                else if(lang == 'English') {
                                    cities = ["Total", "Seoul", "Jeju", "Gyeongsangnam-do", "Gyeongsangbuk-do", "Jeollanam-do", "Jeollabuk-do", "Chungcheongnam-do", "Chungcheongbuk-do", "Gangwon-do", "Gyeonggi-do", "Sejong", "Ulsan",
                                    "Daejeon", "Gwangju", "Incheon", "Daegu", "Busan"];
                                }

                                cities.forEach( (city) => {
                                $("#cities").append(
                                    '<input type="button" value="' + city + '" />'
                                );
                                })
                            }
                        </script>
                    </td>
                </tr>
            </table>
        </fieldset>
        <div id="result">
        </ul>
    </section>
    <footer>
        <p id="copy">&copy; 2021 Jeong Harim</p>
    </footer>
    <script>
        var city = "합계";  // 맨 처음 사이트 접속시 기본적으로 전국 정보 출력
        var lang = "한국어";
        PrintResult();
        ClickCityButton();

        $('#lang_button input[type=button]').on('click', function(value) {
            lang = $(this).val();
            console.log("Result Language: " + lang);

            ClickCityButton();
        })
        
        function ClickCityButton() {
            $('#cities input[type=button]').on('click', function(value) {
                if($(this).val() == "전국")
                    city = "합계";
                else
                    city = $(this).val();   // button의 value를 지역변수 city에 대입.

                console.log(city);
                    
                PrintResult();
            })
        }

        function PrintResult() {
            fetch('result.php')
                .then( (response) => {
                    return response.json();
                })
                .then ( (data) => {
                    let result = $('#result');
                    let items = data.items.item;
                    let cityData;
                    if(lang == "한국어")
                        cityData = items.filter ( (item) => item.gubun ==  city );
                    else if(lang == "English")
                        cityData = items.filter ( (item) => item.gubunEn ==  city );

                    $("#result").empty();   // 새롭게 버튼을 누를 경우 result 초기화.
                    
                    cityData.forEach( (item) => {
                        if(lang == "한국어") {
                            if(city == "합계")
                                result.prepend('<h2 class=\"content\">전국의 코로나19 감염자 현황</h2>');
                            else
                                result.prepend('<h2 class=\"content\">' + city + '의 코로나19 감염자 현황</h2>');

                            result.append(
                                '<p class=\"content\"><b>추가 확진자:</b> ' + item.incDec + ' </p>',
                                '<p class=\"content\"><b>누적 확진자:</b> ' + item.defCnt + ' </p>',
                                '<p class=\"content\"><b>누적 완치자:</b> ' + item.isolClearCnt + ' </p>',
                                '<p class=\"content\"><b>누적 사망자:</b> ' + item.deathCnt + ' </p>',
                                '<p class=\"content\"><b>해외 유입자:</b> ' + item.overFlowCnt + ' </p>',
                                '<p class=\"content\">' + item.stdDay + '기준 </p>'
                            );
                        }
                        else if(lang == "English") {
                            result.prepend('<h2 class=\"content\">' + city + "'s Covid-19 infomations");

                            result.append(
                                '<p class=\"content\"><b>New Confirmed persons:</b> ' + item.incDec + ' </p>',
                                '<p class=\"content\"><b>Accumulate Confirmed persons:</b> ' + item.defCnt + ' </p>',
                                '<p class=\"content\"><b>Accumulate Cure persons:</b> ' + item.isolClearCnt + ' </p>',
                                '<p class=\"content\"><b>Accumulate Deaths:</b> ' + item.deathCnt + ' </p>',
                                '<p class=\"content\"><b>Overseas inflow:</b> ' + item.overFlowCnt + ' </p>',
                                '<p class=\"content\">As of ' + item.stdDay + '</p>'
                            );
                        }
                    }
                )
            });
        }
    </script>
</body>
</html>