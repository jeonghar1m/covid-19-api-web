<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>코로나19 감염자 현황</title>
    <link rel="stylesheet" type="text/css" href="style.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.3/jquery.min.js"></script>
</head>
<body>
    <header>
        <span id="title_name"><h1>코로나19 현황 조회하기</h1></span>
    </header>
    <section>
        <fieldset>
            <legend>도시 선택</legend>
            <table>
                <tr>
                    <td id="cities">
                        <script>
                            const cities = ["합계", "서울", "제주", "경남", "경북", "전남", "전북", "충남", "충북", "강원", "경기", "세종", "울산",
                            "대전", "광주", "인천", "대구", "부산"];
                            cities.forEach( (city) => {
                                $("#cities").append(
                                    '<input type="button" value="' + city + '" />'
                                );
                            })
                        </script>
                    </td>
                </tr>
            </table>
        </fieldset>
        <div id="result">
        </ul>
    </section>
    <footer>
        <p id="copy">&copy; 2021 Jeong Harim</p>
    </footer>
    <script>
        var button = document.querySelectorAll('input');
        var city = "합계";  // 맨 처음 사이트 접속시 기본적으로 전국 정보 출력
        getResult();
        
        $('#cities input[type=button]').on('click', function(value) {
            city = $(this).val();   // button의 value를 지역변수 city에 대입.
            getResult();
        })

        function getResult() {
        fetch('result.php')
            .then( (response) => {
                return response.json();
            })
            .then ( (data) => {
                let result = $('#result');
                let items = data.items.item;
                let cityData = items.filter ( (item) => item.gubun ==  city );

                $("#result").empty();   // 새롭게 버튼을 누를 경우 result 초기화.
                
                cityData.forEach( (item) => {
                    if(city == "합계")
                        result.prepend('<h2 class=\"content\">전국의 코로나19 감염자 현황</h2>');
                    else
                        result.prepend('<h2 class=\"content\">' + city + '의 코로나19 감염자 현황</h2>');

                    result.append(
                        '<p class=\"content\"><b>추가 확진자:</b> ' + item.incDec + ' </p>',
                        '<p class=\"content\"><b>누적 확진자:</b> ' + item.defCnt + ' </p>',
                        '<p class=\"content\"><b>누적 완치자:</b> ' + item.isolClearCnt + ' </p>',
                        '<p class=\"content\"><b>누적 사망자:</b> ' + item.deathCnt + ' </p>'
                    )
                })
            });
        }
    </script>
</body>
</html>